#!/bin/sh
# echo commands
set -x

# exit when any command fails
set -e

sudo nix-channel --update
sudo nix-env -iA nixpkgs.nix 
sudo launchctl remove org.nixos.nix-daemon 
sleep 2
sudo launchctl load /Library/LaunchDaemons/org.nixos.nix-daemon.plist 
# wait for daemon to load again
sleep 10
sudo nix-channel --update
sudo -i nix-channel --update
sudo darwin-rebuild switch
